{% extends "base.html" %}

{% block title %}Add New Employee{% endblock %}

{% block content %}
    <h1>Add New Employee</h1>
    <p><a href="{{ url_for('hr_dashboard') }}">Back to Dashboard</a></p>

    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="alert alert-{{ category }}">{{ message }}</div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <form method="POST">
        <fieldset>
            <legend>Basic Information</legend>
            <label for="employee_name">Name:</label>
            <input type="text" id="employee_name" name="employee_name" required><br>

            <label for="phone_number">Phone Number:</label>
            <input type="tel" id="phone_number" name="phone_number" required><br>

            <label for="title">Job Title (Select or Type New):</label>
            <input type="text" id="title" name="title" list="title_suggestions" required>
            <datalist id="title_suggestions">
                {% for title in titles %}
                    <option value="{{ title }}">
                {% endfor %}
            </datalist><br>
        </fieldset>

        <fieldset>
            <legend>Payroll Details</legend>
            <label>Pay Type:</label>
            <input type="radio" id="pay_salaried" name="pay_type" value="salaried" checked onclick="togglePayFields(false)">
            <label for="pay_salaried">Salaried</label>
            <input type="radio" id="pay_hourly" name="pay_type" value="hourly" onclick="togglePayFields(true)">
            <label for="pay_hourly">Hourly</label><br>

            <div id="salary_rate_field">
                <label for="salary_rate">Salary (Monthly/Annual):</label>
                <input type="number" id="salary_rate" name="salary_rate" step="0.01" min="0" required><br>
            </div>
            
            <div id="hourly_rate_field" style="display:none;">
                <label for="hourly_rate">Hourly Rate:</label>
                <input type="number" id="hourly_rate" name="hourly_rate" step="0.01" min="0"><br>
            </div>
        </fieldset>

        <fieldset>
            <legend>Organizational Affiliation</legend>
            <label>Affiliation Type:</label>
            <input type="radio" id="aff_dept" name="affiliation_type" value="department" checked onclick="toggleAffiliation('department')">
            <label for="aff_dept">Department</label>
            <input type="radio" id="aff_div" name="affiliation_type" value="division" onclick="toggleAffiliation('division')">
            <label for="aff_div">Division</label><br>

            <div id="department_field">
                <label for="department_name">Department Name:</label>
                <select id="department_name" name="department_name">
                    <option value="">(None)</option>
                    {% for dept in departments %}
                        <option value="{{ dept }}">{{ dept }}</option>
                    {% endfor %}
                </select><br>
            </div>

            <div id="division_field" style="display:none;">
                <label for="division_name">Division Name:</label>
                <select id="division_name" name="division_name">
                    <option value="">(None)</option>
                    {% for div in divisions %}
                        <option value="{{ div }}">{{ div }}</option>
                    {% endfor %}
                </select><br>
            </div>
        </fieldset>

        <button type="submit">Add Employee</button>
    </form>

    <script>

        function togglePayFields(isHourly) {
            const hourlyField = document.getElementById('hourly_rate_field');
            const hourlyInput = document.getElementById('hourly_rate');
            const salaryField = document.getElementById('salary_rate_field');
            const salaryInput = document.getElementById('salary_rate');

            if (isHourly) {

                hourlyField.style.display = 'block';
                hourlyInput.setAttribute('required', 'required');
                
                salaryField.style.display = 'none';
                salaryInput.removeAttribute('required');
                salaryInput.value = ''; 
            } else {

                hourlyField.style.display = 'none';
                hourlyInput.removeAttribute('required');
                hourlyInput.value = '';

                salaryField.style.display = 'block';
                salaryInput.setAttribute('required', 'required'); 
            }
        }

        function toggleAffiliation(type) {
            const deptField = document.getElementById('department_field');
            const divField = document.getElementById('division_field');
            
            if (type === 'department') {
                deptField.style.display = 'block';
                divField.style.display = 'none';
            } else if (type === 'division') {
                deptField.style.display = 'none';
                divField.style.display = 'block';
            }
        }
        
        document.addEventListener('DOMContentLoaded', () => {

            togglePayFields(document.getElementById('pay_hourly').checked);
            
            toggleAffiliation(document.querySelector('input[name="affiliation_type"]:checked').value);
        });
    </script>
{% endblock %}